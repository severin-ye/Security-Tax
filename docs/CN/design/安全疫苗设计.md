## ç›®å½•ç»“æ„

```text
repo/
â”œâ”€ README.md
â”‚  # é¡¹ç›®è¯´æ˜ï¼šè®ºæ–‡èƒŒæ™¯ï¼ˆMulti-Agent Security Taxï¼‰ã€ç³»ç»Ÿè®¾è®¡ã€å¤ç°å®éªŒæ–¹æ³•ã€è¿è¡Œæ–¹å¼
â”‚
â”œâ”€ pyproject.toml
â”‚  # Python é¡¹ç›®é…ç½®ï¼šä¾èµ–ï¼ˆlangchain / asyncio / pydantic ç­‰ï¼‰ã€æ ¼å¼åŒ–ä¸æµ‹è¯•
â”‚
â”œâ”€ .env.example
â”‚  # ç¯å¢ƒå˜é‡ç¤ºä¾‹ï¼šOpenAI API Key / æœ¬åœ°æ¨¡å‹è·¯å¾„ / æ—¥å¿—è·¯å¾„
â”‚
â”œâ”€ src/
â”‚  â”œâ”€ app.py
â”‚  â”‚  # ç¨‹åºæ€»å…¥å£ï¼šåŠ è½½é…ç½® â†’ å¯åŠ¨ orchestrator â†’ è¿è¡Œä¸€æ¬¡æˆ–æ‰¹é‡ä»¿çœŸ
â”‚  â”‚
â”‚  â”œâ”€ common/
â”‚  â”‚  â”œâ”€ __init__.py
â”‚  â”‚  â”œâ”€ types.py
â”‚  â”‚  â”‚  # å…¨å±€æ•°æ®ç»“æ„å®šä¹‰ï¼ˆMessage / Event / ToolCall / Outcomeï¼‰
â”‚  â”‚  â”œâ”€ constants.py
â”‚  â”‚  â”‚  # å¸¸é‡ï¼šAgent åç§°ã€ç»ˆæ­¢åŸå› æšä¸¾ã€é£é™©ç±»å‹ã€è¡Œä¸ºç­‰çº§ (-2 ~ +2)
â”‚  â”‚  â”œâ”€ utils.py
â”‚  â”‚  â”‚  # é€šç”¨å·¥å…·å‡½æ•°ï¼šéšæœºç§å­ã€æ—¶é—´æˆ³ã€JSONL è¯»å†™
â”‚  â”‚  â””â”€ logging.py
â”‚  â”‚     # ç»Ÿä¸€æ—¥å¿—æ¥å£ï¼ševents / messages / tool_calls
â”‚  â”‚
â”‚  â”œâ”€ llm/
â”‚  â”‚  â”œâ”€ __init__.py
â”‚  â”‚  â”œâ”€ factory.py
â”‚  â”‚  â”‚  # LLM å·¥å‚ï¼šOpenAI / æœ¬åœ°æ¨¡å‹ / mockï¼ˆæ›¿ä»£ AutoGPT çš„æ¨¡å‹å±‚ï¼‰
â”‚  â”‚  â””â”€ prompts.py
â”‚  â”‚     # Prompt æ‹¼è£…ï¼šsystem + memory + message + scratchpad
â”‚  â”‚
â”‚  â”œâ”€ agents/
â”‚  â”‚  â”œâ”€ __init__.py
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ roles/
â”‚  â”‚  â”‚  â”œâ”€ atlas.yaml
â”‚  â”‚  â”‚  â”‚  # Atlasï¼šé¡¹ç›®ç»ç† Agentï¼ˆä»»åŠ¡æ‹†è§£ä¸è°ƒåº¦ï¼‰
â”‚  â”‚  â”‚  â”œâ”€ bohr.yaml
â”‚  â”‚  â”‚  â”‚  # Bohrï¼šç ”ç©¶å‘˜ Agent
â”‚  â”‚  â”‚  â”œâ”€ curie.yaml
â”‚  â”‚  â”‚  â”‚  # Curieï¼šç ”ç©¶å‘˜ Agent
â”‚  â”‚  â”‚  â”œâ”€ deng.yaml
â”‚  â”‚  â”‚  â”‚  # Dengï¼šæ‰§è¡Œè€… Agentï¼ˆrun_code é«˜é£é™©ï¼‰
â”‚  â”‚  â”‚  â”œâ”€ edison.yaml
â”‚  â”‚  â”‚  â”‚  # Edisonï¼šç ”ç©¶å‘˜ Agent
â”‚  â”‚  â”‚  â”œâ”€ faraday.yaml
â”‚  â”‚  â”‚  â”‚  # Faradayï¼šç ”ç©¶å‘˜ Agent
â”‚  â”‚  â”‚  â””â”€ gauss.yaml
â”‚  â”‚  â”‚     # Gaussï¼šç ”ç©¶å‘˜ Agent
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ prompt_templates/
â”‚  â”‚  â”‚  â”œâ”€ base_system.jinja2
â”‚  â”‚  â”‚  â”‚  # åŸºç¡€ system promptï¼ˆä¸å«é˜²å¾¡ï¼‰
â”‚  â”‚  â”‚  â””â”€ scratchpad.jinja2
â”‚  â”‚  â”‚     # å†…éƒ¨æ€è€ƒæ¨¡æ¿ï¼ˆreact / plan / critiqueï¼‰
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ memory/
â”‚  â”‚  â”‚  â”œâ”€ __init__.py
â”‚  â”‚  â”‚  â”œâ”€ store.py
â”‚  â”‚  â”‚  â”‚  # Agent è®°å¿†æµç»“æ„ï¼ˆappend / prepend / truncateï¼‰
â”‚  â”‚  â”‚  â””â”€ vaccines.py
â”‚  â”‚  â”‚     # è®°å¿†ç–«è‹—æ³¨å…¥é€»è¾‘ï¼ˆpassive / activeï¼‰
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ runtime/
â”‚  â”‚     â”œâ”€ __init__.py
â”‚  â”‚     â”œâ”€ agent_runtime.py
â”‚  â”‚     â”‚  # å•ä¸ª Agent ä¸»å¾ªç¯ï¼šå–æ¶ˆæ¯ â†’ LLM â†’ actions â†’ tools
â”‚  â”‚     â”œâ”€ agent_factory.py
â”‚  â”‚     â”‚  # æ ¹æ®è§’è‰² + é˜²å¾¡ç­–ç•¥åˆ›å»º Agent å®ä¾‹
â”‚  â”‚     â”œâ”€ message_queue.py
â”‚  â”‚     â”‚  # FIFO æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆasyncio.Queue å°è£…ï¼‰
â”‚  â”‚     â””â”€ policy_hooks.py
â”‚  â”‚        # é˜²å¾¡ Hookï¼šsystem patch / memory prepend / æ¶ˆæ¯è¿‡æ»¤
â”‚  â”‚
â”‚  â”œâ”€ tools/
â”‚  â”‚  â”œâ”€ __init__.py
â”‚  â”‚  â”œâ”€ messaging.py
â”‚  â”‚  â”‚  # send_messageï¼šå‘ç›®æ ‡ Agent é˜Ÿåˆ—å‘é€æ¶ˆæ¯
â”‚  â”‚  â”œâ”€ run_code.py
â”‚  â”‚  â”‚  # run_codeï¼šæ¨¡æ‹Ÿä»£ç æ‰§è¡Œï¼ˆå±é™©è¡Œä¸ºå”¯ä¸€å…¥å£ï¼‰
â”‚  â”‚  â”œâ”€ risk_rules.py
â”‚  â”‚  â”‚  # é£é™©æ£€æµ‹è§„åˆ™ï¼šè¯†åˆ«å±é™©åŒ–å­¦æ··åˆ â†’ è§¦å‘â€œçˆ†ç‚¸â€
â”‚  â”‚  â””â”€ langchain_adapters.py
â”‚  â”‚     # LangChain Tool å°è£…ï¼ˆæŠŠå·¥å…·æš´éœ²ç»™ Agentï¼‰
â”‚  â”‚
â”‚  â”œâ”€ orchestrator/
â”‚  â”‚  â”œâ”€ __init__.py
â”‚  â”‚  â”œâ”€ simulation.py
â”‚  â”‚  â”‚  # å•æ¬¡ä»¿çœŸæµç¨‹ï¼šåˆå§‹åŒ– â†’ æ³¨å…¥ä»»åŠ¡ â†’ å¹¶è¡Œè¿è¡Œ â†’ ç»ˆæ­¢
â”‚  â”‚  â”œâ”€ scheduler.py
â”‚  â”‚  â”‚  # å¹¶è¡Œè°ƒåº¦ï¼šä¸ºæ¯ä¸ª Agent å¯åŠ¨ asyncio worker
â”‚  â”‚  â”œâ”€ injection_points.py
â”‚  â”‚  â”‚  # æ³¨å…¥æ—¶æœºç®¡ç†ï¼ˆå¦‚ï¼šç¬¬ 2 æ¡æ¶ˆæ¯åï¼‰
â”‚  â”‚  â”œâ”€ lifecycle.py
â”‚  â”‚  â”‚  # ç»ˆæ­¢æ¡ä»¶ï¼šçˆ†ç‚¸ / æ­»é” / æ¶ˆæ¯ä¸Šé™
â”‚  â”‚  â””â”€ tracing.py
â”‚  â”‚     # å…¨å±€è¿½è¸ªï¼šæ¶ˆæ¯ä¼ æ’­å›¾ã€çŠ¶æ€å˜åŒ–
â”‚  â”‚
â”‚  â”œâ”€ attacks/
â”‚  â”‚  â”œâ”€ __init__.py
â”‚  â”‚  â”œâ”€ injector.py
â”‚  â”‚  â”‚  # æ”»å‡»æ³¨å…¥æ‰§è¡Œå™¨ï¼šå‘ç›®æ ‡ Agent æ³¨å…¥æ¶æ„ prompt
â”‚  â”‚  â”œâ”€ prompt_bank.py
â”‚  â”‚  â”‚  # åŠ è½½ 12 æ¡ jailbreak prompts
â”‚  â”‚  â”œâ”€ target_selection.py
â”‚  â”‚  â”‚  # éšæœºé€‰æ‹©æ”»å‡»ç›®æ ‡ï¼ˆæ’é™¤ Atlas / Dengï¼‰
â”‚  â”‚  â””â”€ schedule.py
â”‚  â”‚     # æ”»å‡»è§¦å‘ç­–ç•¥ï¼ˆä¸ injection_points é…åˆï¼‰
â”‚  â”‚
â”‚  â”œâ”€ defenses/
â”‚  â”‚  â”œâ”€ __init__.py
â”‚  â”‚  â”œâ”€ instructions.py
â”‚  â”‚  â”‚  # æŒ‡ä»¤é˜²å¾¡ï¼šsystem prompt è¿½åŠ ï¼ˆpassive / activeï¼‰
â”‚  â”‚  â”œâ”€ vaccines.py
â”‚  â”‚  â”‚  # ç–«è‹—é˜²å¾¡ï¼šè®°å¿† prependï¼ˆpassive / activeï¼‰
â”‚  â”‚  â”œâ”€ modes.py
â”‚  â”‚  â”‚  # é˜²å¾¡æ¨¡å¼æšä¸¾ï¼ˆNONE / INSTR / VAX Ã— passive/activeï¼‰
â”‚  â”‚  â””â”€ registry.py
â”‚  â”‚     # é˜²å¾¡ç­–ç•¥æ³¨å†Œä¸ç»„åˆï¼ˆå®éªŒçŸ©é˜µï¼‰
â”‚  â”‚
â”‚  â””â”€ eval/
â”‚     â”œâ”€ __init__.py
â”‚     â”œâ”€ robustness.py
â”‚     â”‚  # ç³»ç»Ÿé²æ£’æ€§ï¼šæ˜¯å¦è§¦å‘çˆ†ç‚¸
â”‚     â”œâ”€ cooperation.py
â”‚     â”‚  # åä½œèƒ½åŠ›ï¼šå¥‡æ€ªä½†æ— å®³æŒ‡ä»¤çš„æ¥å—ç‡
â”‚     â”œâ”€ propagation.py
â”‚     â”‚  # ä¼ æ’­åˆ†æï¼šå¤šè·³æ„ŸæŸ“é“¾ã€è¡Œä¸ºç­‰çº§ç»Ÿè®¡
â”‚     â”œâ”€ judge.py
â”‚     â”‚  # LLM-as-judgeï¼ˆå¯é€‰ï¼Œå¯¹é½è®ºæ–‡ï¼‰
â”‚     â””â”€ report.py
â”‚        # æ±‡æ€»ç»“æœå¹¶å¯¼å‡º CSV / JSON
â”‚
â”œâ”€ data/
â”‚  â”œâ”€ attacks/
â”‚  â”‚  â””â”€ jailbreak_prompts.jsonl
â”‚  â”‚     # è®ºæ–‡ä¸­çš„ 12 æ¡æ¶æ„ prompt
â”‚  â”œâ”€ vaccines/
â”‚  â”‚  â”œâ”€ passive.jsonl
â”‚  â”‚  â”‚  # è¢«åŠ¨ç–«è‹—è®°å¿†ç¤ºä¾‹
â”‚  â”‚  â””â”€ active.jsonl
â”‚  â”‚     # ä¸»åŠ¨ç–«è‹—è®°å¿†ç¤ºä¾‹
â”‚  â”œâ”€ harmless/
â”‚  â”‚  â””â”€ weird_but_safe.jsonl
â”‚  â”‚     # å¥‡æ€ªä½†æ— å®³çš„æŒ‡ä»¤ï¼ˆå®éªŒ 2ï¼‰
â”‚  â””â”€ tasks/
â”‚     â””â”€ lab_task_mof.json
â”‚        # åˆå§‹å®éªŒä»»åŠ¡ï¼ˆå‘ç»™ Atlasï¼‰
â”‚
â”œâ”€ configs/
â”‚  â”œâ”€ llm.yaml
â”‚  â”‚  # LLM å‚æ•°ï¼ˆæ¨¡å‹å / temperature / max_tokensï¼‰
â”‚  â”œâ”€ sim.yaml
â”‚  â”‚  # ä»¿çœŸå‚æ•°ï¼ˆmax_messages / timeoutï¼‰
â”‚  â”œâ”€ experiments.yaml
â”‚  â”‚  # å®éªŒè§„æ¨¡ï¼ˆruns / seedsï¼‰
â”‚  â””â”€ defense_matrix.yaml
â”‚     # é˜²å¾¡ç»„åˆçŸ©é˜µï¼ˆè®ºæ–‡è¡¨ 1 / è¡¨ 2ï¼‰
â”‚
â”œâ”€ scripts/
â”‚  â”œâ”€ run_one.py
â”‚  â”‚  # è·‘ä¸€æ¬¡ä»¿çœŸï¼ˆè°ƒè¯•ï¼‰
â”‚  â”œâ”€ run_batch.py
â”‚  â”‚  # æ‰¹é‡è·‘å®éªŒï¼ˆæ‰€æœ‰é˜²å¾¡ Ã— å¤š seedï¼‰
â”‚  â”œâ”€ summarize_runs.py
â”‚  â”‚  # æ±‡æ€» outputs â†’ è¡¨æ ¼
â”‚  â””â”€ make_figures.py
â”‚     # ç”Ÿæˆä¼ æ’­å›¾ / robustness å›¾
â”‚
â”œâ”€ outputs/
â”‚  â”œâ”€ runs/
â”‚  â”‚  â””â”€ <timestamp>_seed42/
â”‚  â”‚     â”œâ”€ events.jsonl
â”‚  â”‚     â”‚  # å…¨äº‹ä»¶æ—¶é—´çº¿
â”‚  â”‚     â”œâ”€ messages.jsonl
â”‚  â”‚     â”‚  # Agent ä¹‹é—´çš„æ¶ˆæ¯ä¼ æ’­
â”‚  â”‚     â”œâ”€ tool_calls.jsonl
â”‚  â”‚     â”‚  # send_message / run_code è®°å½•
â”‚  â”‚     â”œâ”€ outcomes.json
â”‚  â”‚     â”‚  # çˆ†ç‚¸ / ç»ˆæ­¢åŸå› 
â”‚  â”‚     â””â”€ config_snapshot.yaml
â”‚  â”‚        # æœ¬æ¬¡è¿è¡Œçš„å®Œæ•´é…ç½®å¿«ç…§
â”‚  â””â”€ reports/
â”‚     â”œâ”€ table_robustness.csv
â”‚     â”œâ”€ table_cooperation.csv
â”‚     â””â”€ propagation_graphs/
â”‚
â””â”€ tests/
   â”œâ”€ test_risk_rules.py
   â”‚  # é£é™©è§„åˆ™æ˜¯å¦æ­£ç¡®è§¦å‘
   â”œâ”€ test_injection_schedule.py
   â”‚  # æ˜¯å¦ä¸¥æ ¼åœ¨ç¬¬ 2 æ¡æ¶ˆæ¯åæ³¨å…¥
   â””â”€ test_queue_order.py
      # FIFO é˜Ÿåˆ—é¡ºåºæ­£ç¡®æ€§
```

---

## ä¸€ã€æ•´ä½“æ¶æ„æ¦‚è§ˆ

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸ºï¼š

* ä»¿çœŸç¼–æ’å±‚ï¼ˆorchestratorï¼‰ï¼šè´Ÿè´£ä¸€æ¬¡å®Œæ•´ä»¿çœŸçš„ç”Ÿå‘½å‘¨æœŸ
* Agent è¿è¡Œæ—¶å±‚ï¼ˆagentsï¼‰ï¼šå®šä¹‰ Agent çš„è¡Œä¸ºã€è®°å¿†ä¸ç­–ç•¥æ‰©å±•ç‚¹
* å·¥å…·å±‚ï¼ˆtoolsï¼‰ï¼šAgent å¯è°ƒç”¨çš„â€œåŠ¨ä½œæ¥å£â€
* æ”»å‡»å±‚ï¼ˆattacksï¼‰ï¼šåœ¨æŒ‡å®šæ—¶æœºå‘ç³»ç»Ÿæ³¨å…¥å¯¹æŠ—è¾“å…¥
* é˜²å¾¡å±‚ï¼ˆdefensesï¼‰ï¼šé€šè¿‡æŒ‡ä»¤æˆ–è®°å¿†å¢å¼º Agent çš„é²æ£’æ€§
* è¯„æµ‹å±‚ï¼ˆevalï¼‰ï¼šå¯¹ä»¿çœŸç»“æœè¿›è¡Œé‡åŒ–åˆ†æ
* æ•°æ®ä¸é…ç½®ï¼ˆdata / configsï¼‰ï¼šè¾“å…¥æ ·æœ¬ä¸å®éªŒå‚æ•°
* è¾“å‡ºï¼ˆoutputsï¼‰ï¼šä¿è¯å¯å¤ç°ã€å¯è¿½è¸ªçš„å®éªŒç»“æœ

---

## äºŒã€å„æ¨¡å—èŒè´£è¯´æ˜

### 1ï¸âƒ£ src/orchestrator/ â€”â€” ä»¿çœŸç¼–æ’å±‚

è´Ÿè´£ä¸€æ¬¡ä»¿çœŸä»å¯åŠ¨åˆ°ç»“æŸçš„å…¨æµç¨‹æ§åˆ¶ã€‚

* simulation.py
  å•æ¬¡ä»¿çœŸå…¥å£ï¼Œä¸»è¦æµç¨‹ï¼š

  * åˆå§‹åŒ–æ‰€æœ‰ Agents
  * æ³¨å…¥åˆå§‹ä»»åŠ¡
  * å¯åŠ¨å¹¶è¡Œè°ƒåº¦
  * ç­‰å¾…ç»ˆæ­¢æ¡ä»¶è§¦å‘å¹¶æ”¶å°¾

* scheduler.py
  åŸºäº asyncio çš„å¹¶è¡Œè°ƒåº¦å™¨

  * æ¯ä¸ª Agent å¯¹åº”ä¸€ä¸ª worker åç¨‹

* injection_points.py
  ç»Ÿä¸€ç®¡ç†æ”»å‡»è§¦å‘ç‚¹

  * ä¾‹å¦‚ï¼šâ€œç³»ç»Ÿå¤„ç†å®Œç¬¬ 2 æ¡æ¶ˆæ¯åæ³¨å…¥æ”»å‡»â€

* lifecycle.py
  ä»¿çœŸç»ˆæ­¢æ¡ä»¶åˆ¤å®šï¼š

  * çˆ†ç‚¸ï¼ˆå±é™©è¡Œä¸ºï¼‰
  * æ­»é”
  * æ¶ˆæ¯æ•°ä¸Šé™
  * è¶…æ—¶

* tracing.py
  å…¨å±€è¿½è¸ªä¸æ—¥å¿—ï¼š

  * æ¶ˆæ¯å›¾ï¼ˆwho â†’ whoï¼‰
  * å·¥å…·è°ƒç”¨è®°å½•
  * Agent çŠ¶æ€å¿«ç…§

---

### 2ï¸âƒ£ src/agents/ â€”â€” Agent è¿è¡Œæ—¶å±‚

å®šä¹‰ Agent æ˜¯å¦‚ä½•æ€è€ƒã€è®°å¿†ã€è¡ŒåŠ¨çš„ã€‚

#### è§’è‰²ä¸é…ç½®

* roles/*.yaml
  æ¯ä¸ªè§’è‰²çš„é™æ€å®šä¹‰ï¼š

  * system prompt
  * å…è®¸ä½¿ç”¨çš„å·¥å…·
  * é»˜è®¤è¡Œä¸ºç­–ç•¥ï¼ˆå¦‚ Atlas / Deng ç­‰ï¼‰

#### æ ¸å¿ƒè¿è¡Œæ—¶

* runtime/agent_runtime.py
  å•ä¸ª Agent çš„ä¸»å¾ªç¯ï¼š

  * ä»æ¶ˆæ¯é˜Ÿåˆ—å–æ¶ˆæ¯
  * æ„é€  Promptï¼ˆsystem + memory + å½“å‰æ¶ˆæ¯ï¼‰
  * ç”Ÿæˆ actions
  * æ‰§è¡Œå·¥å…·å¹¶è®°å½•ç»“æœ

* runtime/message_queue.py
  Agent çš„æ¶ˆæ¯é˜Ÿåˆ—

  * å½“å‰ä¸º FIFO
  * å¯æ›¿æ¢ä¸º asyncio.Queue å°è£…

#### è®°å¿†ä¸ç­–ç•¥æ‰©å±•

* memory/store.py
  Agent çš„é•¿æœŸ / çŸ­æœŸè®°å¿†æµ

  * æ”¯æŒåœ¨æœ€å‰é¢ prepend â€œç–«è‹—å¯¹è¯â€

* runtime/policy_hooks.py
  é˜²å¾¡æ‰©å±•ç‚¹ï¼ˆhookï¼‰ï¼š

  * system prompt patch
  * memory prepend
  * message filter

---

### 3ï¸âƒ£ src/tools/ â€”â€” å·¥å…·å±‚ï¼ˆæ¶ˆæ¯ + æ‰§è¡Œï¼‰

Agent ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„å”¯ä¸€æ¥å£ã€‚

* messaging.py

  * send_message(recipient, content)
    æœ¬è´¨ï¼šå‘ç›®æ ‡ Agent çš„æ¶ˆæ¯é˜Ÿåˆ—æŠ•é€’ä¸€æ¡æ¶ˆæ¯

* run_code.py

  * run_code(code)
  * æ¨¡æ‹Ÿä»£ç æ‰§è¡Œ
  * å¿…é¡»äº§ç”Ÿæ—¥å¿—
  * å¿…é¡»ç»è¿‡é£é™©åˆ¤å®š

* risk_rules.py
  å±é™©è§„åˆ™é›†åˆ

  * ä¾‹å¦‚æ£€æµ‹å±é™©åŒ–å­¦æ··åˆ
  * ç”¨äºå¤ç°â€œçˆ†ç‚¸â€ç­‰å¤±è´¥çŠ¶æ€

* langchain_adapters.py
  å°†ä¸Šè¿°å·¥å…·å°è£…ä¸º LangChain StructuredTool

---

### 4ï¸âƒ£ src/attacks/ â€”â€” æ”»å‡»å±‚

è´Ÿè´£å¯¹æŠ—æ ·æœ¬çš„é€‰æ‹©ã€æ—¶æœºä¸æ³¨å…¥ã€‚

* schedule.py
  æ”»å‡»è§¦å‘æ—¶æœº

  * é»˜è®¤ï¼šç³»ç»Ÿå¤„ç†å®Œç¬¬ 2 æ¡æ¶ˆæ¯å

* target_selection.py
  æ”»å‡»ç›®æ ‡é€‰æ‹©ï¼š

  * æ’é™¤ Atlas / Deng
  * ä½¿ç”¨éšæœºç§å­ï¼Œä¿è¯å¯å¤ç°

* prompt_bank.py
  åŠ è½½æ”»å‡»æç¤ºï¼š

  * data/attacks/jailbreak_prompts.jsonl

* injector.py
  å®é™…æ‰§è¡Œæ³¨å…¥ï¼š

  * å‘ç›®æ ‡ Agent çš„æ¶ˆæ¯é˜Ÿåˆ—å¡å…¥æ¶æ„æ¶ˆæ¯

---

### 5ï¸âƒ£ src/defenses/ â€”â€” é˜²å¾¡å±‚

ç”¨äºæå‡ Agent å¯¹æ”»å‡»çš„é²æ£’æ€§ã€‚

* instructions.py
  æŒ‡ä»¤é˜²å¾¡ï¼š

  * åœ¨ system prompt æœ«å°¾è¿½åŠ é˜²å¾¡æŒ‡ä»¤
  * åˆ†ä¸º passive / active ä¸¤æ¡£

* vaccines.py
  ç–«è‹—é˜²å¾¡ï¼š

  * å‘ Agent memory çš„æœ€å‰é¢ prepend å¯¹è¯ç‰‡æ®µ
  * åŒæ ·æ”¯æŒ passive / active

* modes.py
  é˜²å¾¡æ¨¡å¼æšä¸¾ï¼š

  * NONE
  * INSTR_PASSIVE
  * INSTR_ACTIVE
  * VAX_PASSIVE
  * VAX_ACTIVE

* registry.py
  æ ¹æ® experiments é…ç½®ï¼Œç”Ÿæˆé˜²å¾¡ç­–ç•¥ç»„åˆ

  * ç”¨äºçŸ©é˜µå¼æ‰¹é‡å®éªŒ

---

### 6ï¸âƒ£ src/eval/ â€”â€” è¯„æµ‹å±‚

å¯¹ä»¿çœŸç»“æœè¿›è¡Œå®šé‡åˆ†æã€‚

* robustness.py
  æ˜¯å¦å‘ç”Ÿçˆ†ç‚¸

  * æ¥æºï¼šrun_code é£é™©åˆ¤å®šæˆ– judge

* cooperation.py
  å¯¹ â€œå¥‡æ€ªä½†æ— å®³â€æŒ‡ä»¤çš„æ¥å—ç‡

  * æ•°æ®æ¥è‡ª weird_but_safe.jsonl

* propagation.py
  æ”»å‡»ä¼ æ’­åˆ†æï¼š

  * who â†’ who
  * æ„ŸæŸ“é“¾é•¿åº¦
  * å¤šè·³ä¼ æ’­è·¯å¾„

* judge.pyï¼ˆå¯é€‰ï¼‰
  ä½¿ç”¨ LLM-as-judge

  * ç”¨äºå¯¹é½è®ºæ–‡è¯„æµ‹å£å¾„

* report.py
  æ±‡æ€»è¾“å‡ºï¼š

  * CSV / JSON
  * ä½œä¸ºå¯è§†åŒ–çš„è¾“å…¥

---

## ä¸‰ã€æ•°æ®ä¸é…ç½®å»ºè®®

### ğŸ“ data/

* attacks/jailbreak_prompts.jsonl
  æ¯è¡Œä¸€ä¸ª {id, prompt}ï¼ˆçº¦ 12 æ¡ï¼‰

* vaccines/passive.jsonl

* vaccines/active.jsonl
  æ¯è¡Œä¸€ä¸ªâ€œè®°å¿†å¯¹è¯ç‰‡æ®µâ€

* harmless/weird_but_safe.jsonl
  â€œå¥‡æ€ªä½†æ— å®³â€çš„æŒ‡ä»¤æ ·æœ¬

* tasks/lab_task_mof.json
  åˆå§‹ä»»åŠ¡ï¼ˆåˆ†é…ç»™ Atlasï¼‰

### ğŸ“ configs/

* llm.yaml
  æ¨¡å‹ / æ¸©åº¦ / æœ€å¤§ token
  æ”¯æŒ OpenAI / æœ¬åœ°æ¨¡å‹

* sim.yaml

  * max_messages
  * deadlock_timeout_s
  * parallelism

* defense_matrix.yaml
  é˜²å¾¡ç­–ç•¥ç»„åˆåˆ—è¡¨ï¼ˆæ‰¹é‡å®éªŒï¼‰

* experiments.yaml

  * è¿è¡Œæ¬¡æ•°
  * seed åˆ—è¡¨
  * è¾“å‡ºè·¯å¾„

---

## å››ã€è¾“å‡ºç»“æ„ï¼ˆå¯å¤ç° & å¯è¿½è¸ªï¼‰

* outputs/runs/<timestamp_seedX>/

  * events.jsonl
    ç»Ÿä¸€äº‹ä»¶æµï¼ˆæ¶ˆæ¯å‡ºé˜Ÿã€å·¥å…·è°ƒç”¨ç­‰ï¼‰
  * messages.jsonl
    who â†’ who + content + step
  * tool_calls.jsonl
    run_code / send_message çš„è¯¦ç»†è®°å½•
  * outcomes.json
    çˆ†ç‚¸ / æ­»é” / ä¸Šé™è§¦å‘ç­‰ç»Ÿè®¡ç»“æœ
  * config_snapshot.yaml
    æœ¬æ¬¡ä»¿çœŸçš„å®Œæ•´é…ç½®å¿«ç…§

---

## è®°å¿†é€»è¾‘

### 1) å“ªäº›æ–‡ä»¶è´Ÿè´£â€œæ¯ä¸ª agent ç‹¬ç«‹â€è¿™ä»¶äº‹

* src/agents/runtime/message_queue.py
  å®šä¹‰ MessageQueueï¼ˆå†…éƒ¨å°è£… asyncio.Queueï¼‰ï¼Œæ¯å®ä¾‹=ä¸€æ¡é˜Ÿåˆ—

* src/agents/memory/store.py
  å®šä¹‰ MemoryStoreï¼ˆå†…éƒ¨æŒæœ‰ä¸€ä¸ª list/dequeï¼‰ï¼Œæ¯å®ä¾‹=ä¸€ä»½è®°å¿†æµ

* src/agents/runtime/agent_runtime.py
  å®šä¹‰ AgentRuntimeï¼ŒæŠŠ MessageQueue + MemoryStore ä½œä¸ºæˆå‘˜å˜é‡ ç»‘å®šåˆ°è¯¥ agent

* src/agents/runtime/agent_factory.py
  å·¥å‚ï¼šæ ¹æ®è§’è‰²é…ç½®åˆ›å»º AgentRuntimeï¼Œå…³é”®æ˜¯æ¯æ¬¡ create éƒ½ new ä¸€å¥— queue+memory

* src/orchestrator/simulation.py
  ä»¿çœŸåˆå§‹åŒ–ï¼šå¾ªç¯åˆ›å»º 7 ä¸ª agentï¼ŒæŠŠå®ƒä»¬æ”¾è¿› agents_by_name æ˜ å°„

* src/tools/messaging.py
  send_message(sender, receiver, content)ï¼šåªåšä¸€ä»¶äº‹â€”â€”æŠŠæ¶ˆæ¯ put() åˆ° receiver çš„ queue

### 2) ä½ å®ç°æ—¶çš„â€œå¯¹è±¡å…³ç³»â€åº”è¯¥é•¿è¿™æ ·

```text
SimulationContext
  â”œâ”€ agents_by_name["Atlas"]  -> AgentRuntime(queue_A, memory_A, ...)
  â”œâ”€ agents_by_name["Bohr"]   -> AgentRuntime(queue_B, memory_B, ...)
  â”œâ”€ agents_by_name["Curie"]  -> AgentRuntime(queue_C, memory_C, ...)
  â””â”€ ...
```

é‡ç‚¹æ˜¯ï¼š

* queue_A is not queue_B
* memory_A is not memory_B
* åªæœ‰ orchestrator æŒæœ‰ä¸€ä¸ªå…¨å±€ agents_by_name ç”¨æ¥è·¯ç”±æ¶ˆæ¯ï¼Œä½†ä¸å…±äº«çŠ¶æ€ã€‚
