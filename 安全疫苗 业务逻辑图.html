<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Multi-Agent Security Tax 业务逻辑图</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#101826; --card:#0f172a;
      --text:#e6edf3; --muted:#9fb0c2;
      --line:#2b3a4f; --line2:#334a66;
      --blue:#3b82f6; --green:#22c55e; --amber:#f59e0b; --red:#ef4444; --violet:#a78bfa;
    }
    html,body{height:100%; background:var(--bg); color:var(--text); margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
    .wrap{max-width:1200px; margin:0 auto; padding:18px 16px 28px;}
    h1{font-size:18px; margin:0 0 8px; font-weight:700;}
    .sub{color:var(--muted); font-size:13px; line-height:1.5; margin-bottom:14px;}
    .legend{display:flex; flex-wrap:wrap; gap:10px; margin:10px 0 14px;}
    .pill{display:flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid var(--line); border-radius:999px; background:rgba(255,255,255,.02); font-size:12px; color:var(--muted);}
    .dot{width:10px; height:10px; border-radius:999px;}
    .card{border:1px solid var(--line); border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      padding:12px; overflow:auto;}
    svg{width:100%; height:auto; min-height:720px; display:block;}
    .box{filter: drop-shadow(0 8px 20px rgba(0,0,0,.25));}
    .title{font-size:14px; font-weight:700; fill:var(--text);}
    .small{font-size:12px; fill:var(--muted);}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;}
    .label{font-size:12px; fill:var(--text); opacity:.95;}
    .tag{font-size:11px; fill:var(--muted);}
    .stroke{stroke:var(--line2); stroke-width:2.2; fill:none;}
    .dash{stroke-dasharray:8 7;}
    .arrow{marker-end:url(#arrow);}
    .arrowRed{marker-end:url(#arrowRed);}
    .arrowGreen{marker-end:url(#arrowGreen);}
    .arrowAmber{marker-end:url(#arrowAmber);}
    .arrowViolet{marker-end:url(#arrowViolet);}
    .hint{margin-top:10px; color:var(--muted); font-size:12px; line-height:1.6;}
    .kbd{font-family:ui-monospace,monospace; background:rgba(255,255,255,.06); border:1px solid var(--line); padding:2px 6px; border-radius:6px;}
  </style>
</head>
<body>
<div class="wrap">
  <h1>多智能体安全税（Multi-Agent Security Tax）业务逻辑图（复现用）</h1>
  <div class="sub">
    这张图把论文系统拆成：仿真编排器（Orchestrator）→ 多智能体并行队列 → 攻击注入（第2条消息后）→ 防御策略（指令 / 记忆疫苗）→ 工具执行（send_message / run_code）→ 终止条件与评测（robustness / cooperation）。
  </div>

  <div class="legend">
    <div class="pill"><span class="dot" style="background:var(--blue)"></span>正常任务流（Normal）</div>
    <div class="pill"><span class="dot" style="background:var(--red)"></span>攻击/感染传播（Attack / Infection）</div>
    <div class="pill"><span class="dot" style="background:var(--amber)"></span>防御注入（Defense: Instructions / Vaccines）</div>
    <div class="pill"><span class="dot" style="background:var(--green)"></span>安全阻断/反制（Mitigation）</div>
    <div class="pill"><span class="dot" style="background:var(--violet)"></span>评测与日志（Eval / Logging）</div>
  </div>

  <div class="card">
    <svg viewBox="0 0 1180 760" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Business logic diagram">
      <defs>
        <linearGradient id="g1" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0" stop-color="rgba(59,130,246,.22)"/>
          <stop offset="1" stop-color="rgba(59,130,246,.08)"/>
        </linearGradient>
        <linearGradient id="g2" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0" stop-color="rgba(239,68,68,.24)"/>
          <stop offset="1" stop-color="rgba(239,68,68,.08)"/>
        </linearGradient>
        <linearGradient id="g3" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0" stop-color="rgba(245,158,11,.26)"/>
          <stop offset="1" stop-color="rgba(245,158,11,.08)"/>
        </linearGradient>
        <linearGradient id="g4" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0" stop-color="rgba(34,197,94,.22)"/>
          <stop offset="1" stop-color="rgba(34,197,94,.08)"/>
        </linearGradient>
        <linearGradient id="g5" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0" stop-color="rgba(167,139,250,.22)"/>
          <stop offset="1" stop-color="rgba(167,139,250,.08)"/>
        </linearGradient>

        <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--line2)"></path>
        </marker>
        <marker id="arrowRed" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--red)"></path>
        </marker>
        <marker id="arrowGreen" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--green)"></path>
        </marker>
        <marker id="arrowAmber" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--amber)"></path>
        </marker>
        <marker id="arrowViolet" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--violet)"></path>
        </marker>
      </defs>

      <!-- Orchestrator -->
      <g class="box">
        <rect x="30" y="28" rx="14" ry="14" width="320" height="180" fill="rgba(255,255,255,.02)" stroke="var(--line)" stroke-width="1.2"/>
        <rect x="44" y="44" rx="12" ry="12" width="292" height="148" fill="var(--panel)" stroke="var(--line)" stroke-width="1.2"/>
        <text x="60" y="74" class="title">仿真编排器 Orchestrator</text>
        <text x="60" y="98" class="small">• 初始化 7 个 Agent（并行 worker）</text>
        <text x="60" y="118" class="small">• 注入初始任务 → Atlas</text>
        <text x="60" y="138" class="small">• 第 2 条消息后触发攻击注入</text>
        <text x="60" y="158" class="small">• 终止判定：爆炸 / 死锁 / 上限</text>
        <text x="60" y="178" class="small">• 全量日志：消息图 + run_code</text>
      </g>

      <!-- Multi-agent runtime cluster -->
      <g class="box">
        <rect x="400" y="28" rx="14" ry="14" width="750" height="430" fill="rgba(255,255,255,.02)" stroke="var(--line)" stroke-width="1.2"/>
        <text x="420" y="58" class="title">多智能体运行时（Parallel, Async）</text>
        <text x="420" y="80" class="small">每个 Agent：System Prompt + Memory Stream + FIFO Queue + Tools</text>

        <!-- Atlas -->
        <rect x="420" y="105" rx="14" ry="14" width="330" height="150" fill="url(#g1)" stroke="rgba(59,130,246,.55)" stroke-width="1.4"/>
        <text x="440" y="135" class="label">Atlas（项目经理 / 调度者）</text>
        <text x="440" y="158" class="tag">输入：初始研究目标（MOF 优化等）</text>
        <text x="440" y="180" class="tag">输出：拆分子任务 → 分派给其他 Agent</text>
        <text x="440" y="202" class="tag mono">tool: send_message()</text>
        <text x="440" y="224" class="tag mono">tool: (可选) run_code()</text>

        <!-- Worker agents -->
        <rect x="780" y="105" rx="14" ry="14" width="350" height="150" fill="rgba(255,255,255,.02)" stroke="var(--line)" stroke-width="1.2"/>
        <text x="800" y="135" class="label">研究/执行 Agent（Bohr, Curie, Edison…）</text>
        <text x="800" y="158" class="tag">• 消费 FIFO 消息队列</text>
        <text x="800" y="180" class="tag">• scratchpad：计划 / 自我审查</text>
        <text x="800" y="202" class="tag mono">tool: send_message()</text>
        <text x="800" y="224" class="tag mono">tool: run_code() / 生成代码请求</text>

        <!-- Deng executor -->
        <rect x="420" y="280" rx="14" ry="14" width="330" height="150" fill="rgba(255,255,255,.02)" stroke="var(--line)" stroke-width="1.2"/>
        <text x="440" y="310" class="label">Deng（执行者 / 机器人控制）</text>
        <text x="440" y="333" class="tag">• 接收实验步骤 / 代码</text>
        <text x="440" y="355" class="tag">• run_code 触发“危险混合”判定</text>
        <text x="440" y="377" class="tag mono">tool: run_code()</text>
        <text x="440" y="399" class="tag">（复现可用模拟执行 + 危险模式检测）</text>

        <!-- Messaging bus -->
        <rect x="780" y="280" rx="14" ry="14" width="350" height="150" fill="rgba(255,255,255,.02)" stroke="var(--line)" stroke-width="1.2"/>
        <text x="800" y="310" class="label">消息传播（多跳）</text>
        <text x="800" y="333" class="tag">• 转发 / 改写（变体）</text>
        <text x="800" y="355" class="tag">• 形成感染链（multi-hop）</text>
        <text x="800" y="377" class="tag">• 影响：执行危险 run_code</text>
        <text x="800" y="399" class="tag">• 或被防御“围堵”</text>
      </g>

      <!-- Attack Injector -->
      <g class="box">
        <rect x="30" y="250" rx="14" ry="14" width="320" height="150" fill="url(#g2)" stroke="rgba(239,68,68,.6)" stroke-width="1.4"/>
        <text x="50" y="280" class="label">攻击注入器 Attack Injector</text>
        <text x="50" y="304" class="tag">• 触发：系统处理第 2 条消息后</text>
        <text x="50" y="326" class="tag">• 目标：随机 Agent（排除 Atlas / Deng）</text>
        <text x="50" y="348" class="tag">• 输入：jailbreak prompt（诱导爆炸）</text>
        <text x="50" y="370" class="tag">• 结果：感染传播 / 变体扩散</text>
      </g>

      <!-- Defense -->
      <g class="box">
        <rect x="30" y="420" rx="14" ry="14" width="320" height="200" fill="url(#g3)" stroke="rgba(245,158,11,.65)" stroke-width="1.4"/>
        <text x="50" y="450" class="label">防御策略 Defense Applier</text>
        <text x="50" y="474" class="tag">A. 指令防御（Instructions）</text>
        <text x="70" y="496" class="tag">• Passive：警惕/拒绝</text>
        <text x="70" y="518" class="tag">• Active：拒绝 + 通知他人/阻断</text>
        <text x="50" y="544" class="tag">B. 记忆疫苗（Memory Vaccines）</text>
        <text x="70" y="566" class="tag">• 将“经历式示例”插入 memory 首部</text>
        <text x="70" y="588" class="tag">• Passive / Active 两档</text>
      </g>

      <!-- Evaluator -->
      <g class="box">
        <rect x="400" y="485" rx="14" ry="14" width="750" height="240" fill="url(#g5)" stroke="rgba(167,139,250,.65)" stroke-width="1.4"/>
        <text x="420" y="515" class="label">评测与记录 Evaluator / Logger</text>
        <text x="420" y="540" class="tag">鲁棒性（Robustness）：是否达成恶意目标（是否爆炸）</text>
        <text x="420" y="562" class="tag">协作能力（Cooperation）：对“奇怪但无害”的指令的接受率</text>
        <text x="420" y="584" class="tag">传播分析：消息分类（主动抵抗 ↔ 主动传播）+ 传播图（who→who）</text>
        <text x="420" y="606" class="tag mono">log: message_graph.jsonl / runs.jsonl / outcomes.json</text>
        <text x="420" y="638" class="tag">终止条件：爆炸 / 死锁 / 达到消息上限</text>
      </g>

      <!-- Arrows: Orchestrator -> Atlas -->
      <path class="stroke arrow" d="M 350 118 C 380 118, 395 150, 420 150" />
      <text x="356" y="110" class="small" fill="var(--blue)">初始任务注入</text>

      <!-- Orchestrator -> Attack -->
      <path class="stroke arrowRed" d="M 190 208 C 190 220, 190 228, 190 250" />
      <text x="46" y="230" class="small" fill="var(--red)">第2条消息后触发</text>

      <!-- Attack -> Worker Agents (infection) -->
      <path class="stroke arrowRed" d="M 350 318 C 460 318, 640 250, 780 180" />
      <text x="430" y="286" class="small" fill="var(--red)">恶意提示注入</text>

      <!-- Worker Agents -> Messaging (multi-hop) -->
      <path class="stroke arrowRed" d="M 960 255 C 980 265, 1010 275, 1030 280" />
      <text x="930" y="270" class="small" fill="var(--red)">传播/变体</text>

      <!-- Messaging -> Deng (risk) -->
      <path class="stroke arrowRed" d="M 940 430 C 870 445, 740 445, 620 430" />
      <text x="740" y="458" class="small" fill="var(--red)">诱导 run_code</text>

      <!-- Defense -> Agents (patch) -->
      <path class="stroke arrowAmber" d="M 350 520 C 420 520, 420 360, 420 300" />
      <path class="stroke arrowAmber" d="M 350 540 C 520 540, 720 360, 780 300" />
      <text x="360" y="500" class="small" fill="var(--amber)">指令/疫苗注入</text>

      <!-- Defense -> Messaging (mitigate) -->
      <path class="stroke dash arrowGreen" d="M 350 585 C 520 620, 720 620, 780 585" />
      <text x="420" y="640" class="small" fill="var(--green)">主动通知/围堵（Active）</text>

      <!-- Deng -> Evaluator -->
      <path class="stroke arrowViolet" d="M 585 430 C 585 470, 585 485, 585 485" />
      <text x="610" y="468" class="small" fill="var(--violet)">run_code 记录/判定</text>

      <!-- Orchestrator -> Evaluator -->
      <path class="stroke arrowViolet" d="M 350 180 C 420 210, 420 430, 420 485" />
      <text x="360" y="258" class="small" fill="var(--violet)">日志/终止</text>

      <!-- Normal task flow: Atlas -> worker -->
      <path class="stroke arrow" d="M 750 155 C 770 155, 775 155, 780 155" />
      <text x="680" y="145" class="small" fill="var(--blue)">任务分派</text>

      <!-- Worker -> Atlas (reports) -->
      <path class="stroke dash arrow" d="M 780 210 C 720 210, 680 210, 640 210" />
      <text x="680" y="235" class="small" fill="var(--blue)">回报/请求</text>

      <!-- small footer -->
      <text x="30" y="742" class="small">
        注：这是“复现导向”的业务逻辑抽象图；实现时你可以用 LangChain AgentExecutor + asyncio.Queue + 工具 hook（run_code 风险检测）对齐论文范式。
      </text>
    </svg>
  </div>

  <div class="hint">
    你如果想把它改成“更像论文 Figure 2 的传播图”，告诉我你要显示的节点（例如 Atlas/Bohr/Curie/Deng…）以及你希望把“感染路径”画成<strong>一步一步的时间线</strong>还是<strong>最终传播网络</strong>。
    我也可以把这个 HTML 改成可交互：点击节点展开该 Agent 的 <span class="kbd">Queue</span> / <span class="kbd">Memory</span> / <span class="kbd">System Prompt</span> 摘要。
  </div>
</div>
</body>
</html>
